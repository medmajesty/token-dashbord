<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Fluctuating USD Token Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input { width: 400px; padding: 5px; margin-right: 10px; }
    button { padding: 5px 10px; }
    h2 { margin-top: 20px; white-space: pre-line; }
  </style>
</head>
<body>
  <h1>Fluctuating USD Token Dashboard</h1>
  <p>Enter a wallet address to see token balance and USD value:</p>

  <input type="text" id="wallet" placeholder="0x...">
  <button onclick="showBalance()">Show Balance in USD</button>

  <h2 id="result"></h2>

  <script>
    // Direct contract address
    const contractAddress = "0x5858D7890b963F571352Ca19087547b2899963e8";

    // Contract ABI
    const abi = [
      "function balanceOf(address) view returns (uint256)",
      "function balanceInUSD(address) view returns (uint256)",
      "function decimals() view returns (uint8)"
    ];

    async function showBalance() {
      const wallet = document.getElementById("wallet").value.trim();
      if (!wallet) return alert("Please enter a wallet address.");

      if (!window.ethereum) return alert("MetaMask not detected!");

      // Connect to Ethereum via MetaMask
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);

      const contract = new ethers.Contract(contractAddress, abi, provider);

      try {
        // Get token decimals
        const decimals = await contract.decimals();

        // Get token balance
        const tokenBalanceRaw = await contract.balanceOf(wallet);
        const tokenBalance = tokenBalanceRaw / (10 ** decimals);

        // Get USD value
        const usdBalanceRaw = await contract.balanceInUSD(wallet);
        const usdBalance = usdBalanceRaw / (10 ** 8); // 8 decimals for USD value

        // Display results
        document.getElementById("result").innerText =
          Wallet: ${wallet}\nTokens: ${tokenBalance}\nValue in USD: $${usdBalance.toFixed(4)};
      } catch (err) {
        console.error(err);
        alert("Error reading data from contract.");
      }
    }
  </script>
</body>

</html>
